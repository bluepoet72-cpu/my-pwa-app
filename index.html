<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ============================================================
         [APP CONFIG] ì•± ê¸°ë³¸ ì„¤ì • - ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ì„¸ìš”!
         ============================================================ -->
    <title>ë‚´ ë‘ ë²ˆì§¸ ì•±</title>
    
    <!-- PWA ì„¤ì • -->
    <link rel="manifest" href="manifest.webmanifest">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ì•„ì´ë””ì–´ ì•±">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <style>
/* ================================================================
   [STYLES] CSS ìŠ¤íƒ€ì¼
   ================================================================
   êµ¬ì¡°:
   1. BASE      - ê¸°ë³¸ ë¦¬ì…‹, í°íŠ¸
   2. LAYOUT    - ì „ì²´ ë ˆì´ì•„ì›ƒ, ì»¨í…Œì´ë„ˆ
   3. COMPONENTS - ë²„íŠ¼, ì…ë ¥ì°½ ë“± ì¬ì‚¬ìš© ìš”ì†Œ
   4. SECTIONS  - ê° ê¸°ëŠ¥ë³„ ì„¹ì…˜ ìŠ¤íƒ€ì¼
   5. THEME     - ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼
   6. ANIMATIONS - ì• ë‹ˆë©”ì´ì…˜
   ================================================================ */

/* ----------------------------------------------------------------
   1. BASE - ê¸°ë³¸ ì„¤ì •
   ---------------------------------------------------------------- */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    position: relative;

    /* ============================================================
       [CUSTOMIZE] ë°°ê²½ìƒ‰ - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
       ============================================================ */
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* ----------------------------------------------------------------
   2. LAYOUT - ë ˆì´ì•„ì›ƒ
   ---------------------------------------------------------------- */
.container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    padding: 40px;
    max-width: 600px;
    width: 100%;
}

h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
    font-size: 28px;
}

/* ----------------------------------------------------------------
   3. COMPONENTS - ê³µí†µ ì»´í¬ë„ŒíŠ¸
   ---------------------------------------------------------------- */
button {
    /* ============================================================
       [CUSTOMIZE] ë²„íŠ¼ ê¸°ë³¸ìƒ‰ - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
       ============================================================ */
    background: #667eea;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 600;
}

button:hover {
    background: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

button:active {
    transform: translateY(0);
}

button.small {
    padding: 6px 12px;
    font-size: 14px;
}

button.delete-btn {
    background: #ef4444;
    padding: 6px 12px;
    font-size: 14px;
}

button.delete-btn:hover {
    background: #dc2626;
    box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
}

button.secondary {
    background: #6b7280;
}

button.secondary:hover {
    background: #4b5563;
}

input[type="text"],
input[type="file"] {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s;
}

input[type="text"]:focus {
    outline: none;
    /* ============================================================
       [CUSTOMIZE] í¬ì»¤ìŠ¤ ìƒ‰ìƒ - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
       ============================================================ */
    border-color: #667eea;
}

input[type="file"] {
    padding: 10px 12px;
    font-size: 14px;
}

/* ----------------------------------------------------------------
   4. SECTIONS - ê¸°ëŠ¥ë³„ ì„¹ì…˜
   ---------------------------------------------------------------- */

/* í…Œë§ˆ í† ê¸€ */
.theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50px;
    padding: 8px 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-weight: 600;
    transition: all 0.3s;
    backdrop-filter: blur(10px);
}

.theme-toggle:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

.toggle-switch {
    width: 50px;
    height: 26px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 13px;
    position: relative;
    transition: all 0.3s;
}

.toggle-slider {
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: all 0.3s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.theme-toggle.active .toggle-slider {
    left: 26px;
}

.theme-toggle.active .toggle-switch {
    background: rgba(255, 255, 255, 0.5);
}

/* ì¹´ìš´í„° ì„¹ì…˜ */
.counter-section {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
    text-align: center;
}

.counter-display {
    font-size: 48px;
    font-weight: bold;
    margin-bottom: 20px;
    /* ============================================================
       [CUSTOMIZE] ì¹´ìš´í„° ìˆ«ì ìƒ‰ìƒ - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
       ============================================================ */
    color: #667eea;
}

.counter-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

/* ë©”ëª¨ ì„¹ì…˜ */
.memo-section {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
}

.search-filter-section {
    margin-bottom: 20px;
}

.search-box {
    margin-bottom: 15px;
}

.filter-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
}

.filter-buttons button {
    flex: 1;
    padding: 8px 12px;
    font-size: 14px;
}

.filter-buttons button.active {
    background: #764ba2;
}

.memo-input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.memo-list {
    max-height: 400px;
    overflow-y: auto;
}

.memo-item {
    background: white;
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s;
    /* ============================================================
       [CUSTOMIZE] ë©”ëª¨ ì•„ì´í…œ ê°•ì¡°ìƒ‰ - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
       ============================================================ */
    border-left: 4px solid #667eea;
}

.memo-item.completed {
    opacity: 0.6;
}

.memo-item.completed .memo-text {
    text-decoration: line-through;
    color: #6b7280;
}

.memo-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
    flex-shrink: 0;
}

.memo-text {
    flex: 1;
    word-break: break-word;
}

.memo-actions {
    display: flex;
    gap: 8px;
    flex-shrink: 0;
}

.empty-message {
    text-align: center;
    color: #999;
    padding: 20px;
}

.export-buttons {
    display: flex;
    gap: 8px;
    margin-top: 20px;
}

.export-buttons button {
    flex: 1;
    font-size: 14px;
    padding: 10px 16px;
}

.import-section {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px solid #e0e0e0;
}

/* Undo í† ìŠ¤íŠ¸ */
.undo-toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #1f2937;
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 15px;
    animation: slideUp 0.3s;
    z-index: 1000;
}

.undo-toast button {
    background: #10b981;
    padding: 8px 16px;
    font-size: 14px;
}

.undo-toast button:hover {
    background: #059669;
}

/* ----------------------------------------------------------------
   5. THEME - ë‹¤í¬ëª¨ë“œ
   ---------------------------------------------------------------- */
body.dark-mode {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}

body.dark-mode .container {
    background: #0f3460;
    color: #e0e0e0;
}

body.dark-mode h1 {
    color: #e0e0e0;
}

body.dark-mode .counter-section,
body.dark-mode .memo-section {
    background: #1a1a2e;
}

body.dark-mode .counter-display {
    color: #7dd3fc;
}

body.dark-mode button {
    background: #0891b2;
}

body.dark-mode button:hover {
    background: #0e7490;
    box-shadow: 0 5px 15px rgba(8, 145, 178, 0.4);
}

body.dark-mode input[type="text"] {
    background: #0f3460;
    border-color: #1a1a2e;
    color: #e0e0e0;
}

body.dark-mode input[type="text"]:focus {
    border-color: #0891b2;
}

body.dark-mode .memo-item {
    background: #0f3460;
    border-left-color: #0891b2;
    color: #e0e0e0;
}

body.dark-mode .empty-message {
    color: #666;
}

body.dark-mode .filter-buttons button.active {
    background: #a855f7;
}

body.dark-mode button.delete-btn {
    background: #dc2626;
}

body.dark-mode button.delete-btn:hover {
    background: #b91c1c;
}

body.dark-mode .memo-item.completed .memo-text {
    color: #9ca3af;
}

body.dark-mode .import-section {
    border-top-color: #1a1a2e;
}

/* ----------------------------------------------------------------
   6. ANIMATIONS - ì• ë‹ˆë©”ì´ì…˜
   ---------------------------------------------------------------- */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}
    </style>
</head>
<body>
    <!-- ============================================================
         [UI] HTML êµ¬ì¡°
         ============================================================
         êµ¬ì¡°:
         1. í…Œë§ˆ í† ê¸€ ë²„íŠ¼
         2. ë©”ì¸ ì»¨í…Œì´ë„ˆ
            - ì œëª©
            - ì¹´ìš´í„° ì„¹ì…˜
            - ë©”ëª¨ ì„¹ì…˜
         ============================================================ -->

    <!-- í…Œë§ˆ í† ê¸€ -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <span>ğŸŒ™</span>
        <div class="toggle-switch">
            <div class="toggle-slider"></div>
        </div>
    </div>

    <div class="container">
        <!-- ========================================================
             [CUSTOMIZE] ì•± ì œëª© - ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”!
             ======================================================== -->
        <h1>ë‚´ ë‘ ë²ˆì§¸ ì•±</h1>

        <!-- ========================================================
             [SECTION] ì¹´ìš´í„° ì„¹ì…˜
             - í•„ìš”ì—†ìœ¼ë©´ ì´ ì„¹ì…˜ ì „ì²´ë¥¼ ì‚­ì œí•˜ì„¸ìš”
             ======================================================== -->
        <div class="counter-section">
            <div class="counter-display" id="counterDisplay">0</div>
            <div class="counter-buttons">
                <button onclick="increaseCounter()">+1</button>
                <button onclick="resetCounter()">ë¦¬ì…‹</button>
            </div>
        </div>

        <!-- ========================================================
             [SECTION] ë©”ëª¨ ì„¹ì…˜
             - í•„ìš”ì—†ìœ¼ë©´ ì´ ì„¹ì…˜ ì „ì²´ë¥¼ ì‚­ì œí•˜ì„¸ìš”
             ======================================================== -->
        <div class="memo-section">
            <!-- ê²€ìƒ‰ ë° í•„í„° -->
            <div class="search-filter-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ì•„ì´ë””ì–´ ê²€ìƒ‰..." oninput="filterMemos()">
                </div>
                <div class="filter-buttons">
                    <button class="active" onclick="setFilter('all')">ì „ì²´</button>
                    <button onclick="setFilter('active')">ì§„í–‰ì¤‘</button>
                    <button onclick="setFilter('completed')">ì™„ë£Œ</button>
                </div>
            </div>

            <!-- ë©”ëª¨ ì…ë ¥ -->
            <div class="memo-input-group">
                <input type="text" id="memoInput" placeholder="ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)">
                <button onclick="addMemo()">ì•„ì´ë””ì–´ ì¶”ê°€</button>
            </div>

            <!-- ë©”ëª¨ ëª©ë¡ -->
            <div class="memo-list" id="memoList">
                <div class="empty-message">ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>

            <!-- ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° -->
            <div class="export-buttons">
                <button onclick="exportJSON()">ë‚´ë³´ë‚´ê¸° (.json)</button>
                <button onclick="exportTXT()">ë‚´ë³´ë‚´ê¸° (.txt)</button>
            </div>

            <div class="import-section">
                <input type="file" id="importFile" accept=".json" onchange="importJSON(event)">
            </div>
        </div>
    </div>

    <script>
/* ================================================================
   [JAVASCRIPT] ì•± ë¡œì§
   ================================================================
   êµ¬ì¡°:
   1. CONFIG    - ì•± ì„¤ì •ê°’
   2. STATE     - ìƒíƒœ ë³€ìˆ˜
   3. STORAGE   - ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
   4. UI        - í™”ë©´ ë Œë”ë§
   5. EVENTS    - ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
   6. UTILS     - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
   7. INIT      - ì´ˆê¸°í™”
   ================================================================ */

/* ----------------------------------------------------------------
   1. CONFIG - ì•± ì„¤ì •
   ----------------------------------------------------------------
   [CUSTOMIZE] ì•± ë™ì‘ì„ ë³€ê²½í•˜ë ¤ë©´ ì—¬ê¸°ë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
   ---------------------------------------------------------------- */
const CONFIG = {
    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ (ì•±ë§ˆë‹¤ ë‹¤ë¥´ê²Œ ì„¤ì •)
    STORAGE_KEYS: {
        COUNTER: 'counter',
        MEMOS: 'memos',
        DARK_MODE: 'darkMode'
    },

    // ë˜ëŒë¦¬ê¸° í† ìŠ¤íŠ¸ í‘œì‹œ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
    UNDO_TIMEOUT: 5000,

    // íŒŒì¼ ë‚´ë³´ë‚´ê¸° ì ‘ë‘ì–´
    EXPORT_PREFIX: 'memo-backup'
};

/* ----------------------------------------------------------------
   2. STATE - ìƒíƒœ ê´€ë¦¬
   ----------------------------------------------------------------
   ì•±ì˜ í˜„ì¬ ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜ë“¤
   ---------------------------------------------------------------- */
const STATE = {
    counter: 0,
    memos: [],
    currentFilter: 'all',
    deletedMemo: null,
    undoTimeout: null
};

/* ----------------------------------------------------------------
   3. STORAGE - ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
   ----------------------------------------------------------------
   localStorageë¥¼ ì‚¬ìš©í•œ ë°ì´í„° ì˜ì†í™”
   ---------------------------------------------------------------- */
const Storage = {
    // ëª¨ë“  ë°ì´í„° ì €ì¥
    save() {
        localStorage.setItem(CONFIG.STORAGE_KEYS.COUNTER, STATE.counter);
        localStorage.setItem(CONFIG.STORAGE_KEYS.MEMOS, JSON.stringify(STATE.memos));
    },

    // ëª¨ë“  ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    load() {
        const savedCounter = localStorage.getItem(CONFIG.STORAGE_KEYS.COUNTER);
        const savedMemos = localStorage.getItem(CONFIG.STORAGE_KEYS.MEMOS);
        const savedTheme = localStorage.getItem(CONFIG.STORAGE_KEYS.DARK_MODE);

        if (savedCounter !== null) {
            STATE.counter = parseInt(savedCounter);
            UI.updateCounterDisplay();
        }

        if (savedMemos !== null) {
            STATE.memos = JSON.parse(savedMemos);
            // ê¸°ì¡´ ë°ì´í„°ê°€ ë¬¸ìì—´ ë°°ì—´ì¸ ê²½ìš° ê°ì²´ë¡œ ë³€í™˜
            STATE.memos = STATE.memos.map(memo => {
                if (typeof memo === 'string') {
                    return { text: memo, completed: false, id: Date.now() + Math.random() };
                }
                return memo;
            });
            UI.renderMemos();
        }

        if (savedTheme === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').classList.add('active');
        }
    },

    // í…Œë§ˆ ì €ì¥
    saveTheme(isDark) {
        localStorage.setItem(CONFIG.STORAGE_KEYS.DARK_MODE, isDark);
    }
};

/* ----------------------------------------------------------------
   4. UI - í™”ë©´ ë Œë”ë§
   ----------------------------------------------------------------
   DOM ì¡°ì‘ ë° í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
   ---------------------------------------------------------------- */
const UI = {
    // ì¹´ìš´í„° í‘œì‹œ ì—…ë°ì´íŠ¸
    updateCounterDisplay() {
        document.getElementById('counterDisplay').textContent = STATE.counter;
    },

    // ë©”ëª¨ ëª©ë¡ ë Œë”ë§
    renderMemos() {
        const memoList = document.getElementById('memoList');
        const filtered = this.getFilteredMemos();

        if (filtered.length === 0) {
            memoList.innerHTML = '<div class="empty-message">ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }

        memoList.innerHTML = filtered.map(memo => {
            const completedClass = memo.completed ? 'completed' : '';
            return `
                <div class="memo-item ${completedClass}">
                    <input type="checkbox" class="memo-checkbox"
                           ${memo.completed ? 'checked' : ''}
                           onchange="Events.toggleMemo(${memo.id})">
                    <span class="memo-text">${Utils.escapeHtml(memo.text)}</span>
                    <div class="memo-actions">
                        <button class="delete-btn" onclick="Events.deleteMemo(${memo.id})">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }).join('');
    },

    // í•„í„°ë§ëœ ë©”ëª¨ ê°€ì ¸ì˜¤ê¸°
    getFilteredMemos() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();

        return STATE.memos.filter(memo => {
            const matchesSearch = memo.text.toLowerCase().includes(searchTerm);

            let matchesFilter = true;
            if (STATE.currentFilter === 'active') {
                matchesFilter = !memo.completed;
            } else if (STATE.currentFilter === 'completed') {
                matchesFilter = memo.completed;
            }

            return matchesSearch && matchesFilter;
        });
    },

    // ë˜ëŒë¦¬ê¸° í† ìŠ¤íŠ¸ í‘œì‹œ
    showUndoToast() {
        const existingToast = document.querySelector('.undo-toast');
        if (existingToast) {
            existingToast.remove();
        }

        if (STATE.undoTimeout) {
            clearTimeout(STATE.undoTimeout);
        }

        const toast = document.createElement('div');
        toast.className = 'undo-toast';
        toast.innerHTML = `
            <span>ì•„ì´ë””ì–´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤</span>
            <button onclick="Events.undoDelete()">ë˜ëŒë¦¬ê¸°</button>
        `;
        document.body.appendChild(toast);

        STATE.undoTimeout = setTimeout(() => {
            toast.remove();
            STATE.deletedMemo = null;
        }, CONFIG.UNDO_TIMEOUT);
    },

    // ë˜ëŒë¦¬ê¸° í† ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
    hideUndoToast() {
        const toast = document.querySelector('.undo-toast');
        if (toast) {
            toast.remove();
        }

        if (STATE.undoTimeout) {
            clearTimeout(STATE.undoTimeout);
        }
    }
};

/* ----------------------------------------------------------------
   5. EVENTS - ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
   ----------------------------------------------------------------
   [CUSTOMIZE] ìƒˆ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ ì—¬ê¸°ì— í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”!
   ---------------------------------------------------------------- */
const Events = {
    // ì¹´ìš´í„° ì¦ê°€
    increaseCounter() {
        STATE.counter++;
        UI.updateCounterDisplay();
        Storage.save();
    },

    // ì¹´ìš´í„° ë¦¬ì…‹
    resetCounter() {
        STATE.counter = 0;
        UI.updateCounterDisplay();
        Storage.save();
    },

    // ë©”ëª¨ ì¶”ê°€
    addMemo() {
        const input = document.getElementById('memoInput');
        const memoText = input.value.trim();

        if (memoText === '') {
            alert('ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            return;
        }

        const newMemo = {
            id: Date.now(),
            text: memoText,
            completed: false
        };

        STATE.memos.unshift(newMemo);
        input.value = '';
        UI.renderMemos();
        Storage.save();
    },

    // ë©”ëª¨ ì™„ë£Œ í† ê¸€
    toggleMemo(id) {
        const memo = STATE.memos.find(m => m.id === id);
        if (memo) {
            memo.completed = !memo.completed;
            UI.renderMemos();
            Storage.save();
        }
    },

    // ë©”ëª¨ ì‚­ì œ
    deleteMemo(id) {
        const index = STATE.memos.findIndex(m => m.id === id);
        if (index !== -1) {
            STATE.deletedMemo = { memo: STATE.memos[index], index: index };
            STATE.memos.splice(index, 1);
            UI.renderMemos();
            Storage.save();
            UI.showUndoToast();
        }
    },

    // ì‚­ì œ ë˜ëŒë¦¬ê¸°
    undoDelete() {
        if (STATE.deletedMemo) {
            STATE.memos.splice(STATE.deletedMemo.index, 0, STATE.deletedMemo.memo);
            UI.renderMemos();
            Storage.save();
            UI.hideUndoToast();
            STATE.deletedMemo = null;
        }
    },

    // í•„í„° ì„¤ì •
    setFilter(filter) {
        STATE.currentFilter = filter;

        const buttons = document.querySelectorAll('.filter-buttons button');
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        UI.renderMemos();
    },

    // ë©”ëª¨ í•„í„°ë§ (ê²€ìƒ‰)
    filterMemos() {
        UI.renderMemos();
    },

    // Enter í‚¤ ì²˜ë¦¬
    handleEnter(event) {
        if (event.key === 'Enter') {
            this.addMemo();
        }
    },

    // í…Œë§ˆ í† ê¸€
    toggleTheme() {
        const isDark = document.body.classList.toggle('dark-mode');
        document.querySelector('.theme-toggle').classList.toggle('active');
        Storage.saveTheme(isDark);
    },

    // JSON ë‚´ë³´ë‚´ê¸°
    exportJSON() {
        const data = {
            counter: STATE.counter,
            darkMode: document.body.classList.contains('dark-mode'),
            memos: STATE.memos
        };

        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `${CONFIG.EXPORT_PREFIX}-${new Date().toISOString().slice(0, 10)}.json`;
        a.click();

        URL.revokeObjectURL(url);
    },

    // TXT ë‚´ë³´ë‚´ê¸°
    exportTXT() {
        let txtContent = '=== ë‚´ ì•„ì´ë””ì–´ ëª©ë¡ ===\n\n';

        STATE.memos.forEach((memo, index) => {
            const status = memo.completed ? '[ì™„ë£Œ]' : '[ì§„í–‰ì¤‘]';
            txtContent += `${index + 1}. ${status} ${memo.text}\n`;
        });

        const blob = new Blob([txtContent], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = `idea-list-${new Date().toISOString().slice(0, 10)}.txt`;
        a.click();

        URL.revokeObjectURL(url);
    },

    // JSON ê°€ì ¸ì˜¤ê¸°
    importJSON(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);

                if (data.counter !== undefined) {
                    STATE.counter = data.counter;
                    UI.updateCounterDisplay();
                }

                if (data.memos !== undefined) {
                    STATE.memos = data.memos;
                    UI.renderMemos();
                }

                if (data.darkMode !== undefined) {
                    if (data.darkMode) {
                        document.body.classList.add('dark-mode');
                        document.querySelector('.theme-toggle').classList.add('active');
                    } else {
                        document.body.classList.remove('dark-mode');
                        document.querySelector('.theme-toggle').classList.remove('active');
                    }
                    Storage.saveTheme(data.darkMode);
                }

                Storage.save();
                alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');

                event.target.value = '';
            } catch (error) {
                alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(error);
            }
        };
        reader.readAsText(file);
    }
};

/* ----------------------------------------------------------------
   6. UTILS - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
   ----------------------------------------------------------------
   ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í—¬í¼ í•¨ìˆ˜ë“¤
   ---------------------------------------------------------------- */
const Utils = {
    // HTML ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€)
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
};

/* ----------------------------------------------------------------
   7. INIT - ì´ˆê¸°í™”
   ----------------------------------------------------------------
   ì•± ì‹œì‘ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
   ---------------------------------------------------------------- */

// ì „ì—­ í•¨ìˆ˜ ì—°ê²° (HTML onclickì—ì„œ í˜¸ì¶œ)
function increaseCounter() { Events.increaseCounter(); }
function resetCounter() { Events.resetCounter(); }
function addMemo() { Events.addMemo(); }
function toggleMemo(id) { Events.toggleMemo(id); }
function deleteMemo(id) { Events.deleteMemo(id); }
function setFilter(filter) { Events.setFilter(filter); }
function filterMemos() { Events.filterMemos(); }
function handleEnter(event) { Events.handleEnter(event); }
function toggleTheme() { Events.toggleTheme(); }
function exportJSON() { Events.exportJSON(); }
function exportTXT() { Events.exportTXT(); }
function importJSON(event) { Events.importJSON(event); }

// ì•± ì‹œì‘
Storage.load();

/* ----------------------------------------------------------------
   8. PWA - Service Worker ë“±ë¡
   ---------------------------------------------------------------- */
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
                console.log('[PWA] Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
            })
            .catch((error) => {
                console.log('[PWA] Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
            });
    });
}
    </script>
</body>
</html>
